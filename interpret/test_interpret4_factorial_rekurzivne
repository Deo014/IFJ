#/' Program 4: Vypocet faktorialu (rekurzivne) '/
#Declare Function factorial (n As Integer) As Integer
#Function factorial (n As Integer) As Integer
#Dim temp_result As Integer
#Dim decremented_n As Integer
#Dim result As Integer
#If n < 2 Then
#result = 1
#Else
#decremented_n = n - 1
#temp_result = factorial(decremented_n)
#result = n * temp_result
#End If
#Return result
#End Function
#Scope 'Hlavni telo programu
#Dim a As Integer
#Dim vysl As Integer
#Print !"Zadejte cislo pro vypocet faktorialu";
#Input a
#If a < 0 Then
#Print !"\nFaktorial nelze spocitat\n";
#Else
#vysl = factorial(a)
#Print !"\nVysledek je:" ; vysl ; !"\n";
#End If
#End Scope

.IFJcode17
JUMP $$scope
LABEL $factorial
PUSHFRAME
##WRITE string@\032->call_factorial:
##WRITE string@n=
##WRITE LF@n

DEFVAR LF@%retval
MOVE LF@%retval int@1
DEFVAR LF@temp_result
MOVE LF@temp_result int@1 # prozatím
DEFVAR LF@decremented_n
MOVE LF@decremented_n LF@n
DEFVAR LF@result
LT GF@cmp LF@n int@2
JUMPIFEQ $endfactorial GF@cmp bool@true

SUB LF@decremented_n LF@decremented_n int@1
##WRITE string@,\032decremented_n=
##WRITE LF@decremented_n
##WRITE string@\010
################# REKURZE ##########################
LABEL $rekurze
CREATEFRAME
DEFVAR TF@n
MOVE TF@n LF@decremented_n
CALL $factorial
##WRITE string@factorial_return:
##WRITE TF@%retval
##WRITE string@\010
MUL LF@temp_result LF@decremented_n TF@%retval
LABEL $endrekurze
#####################################################
#MUL LF@temp_result LF@temp_result TF@n
JUMP $endfactorial
LABEL $result1
MOVE LF@result int@1
LABEL $endfactorial
MOVE LF@%retval LF@temp_result
POPFRAME
RETURN

LABEL $$scope
DEFVAR GF@a
DEFVAR GF@vysl
WRITE string@NENI\032JESTE\032PLNE\032FUNKCNI\010
WRITE string@Zadejte\032cislo\032pro\032vypocet\032faktorialu:\032
READ GF@a int
DEFVAR GF@cmp
LT GF@cmp GF@a int@0
JUMPIFEQ $true GF@cmp bool@false # a < 0
DPRINT string@Faktorial\032nelze\032spocitat\010
JUMP $$endscope
LABEL $true
CREATEFRAME
DEFVAR TF@n
MOVE TF@n GF@a
CALL $factorial
MOVE GF@vysl TF@%retval
MUL GF@vysl GF@vysl TF@n
WRITE string@Vysledek\032je
WRITE GF@vysl
WRITE string@\010
LABEL $$endscope
##BREAK # ladící výpisy
